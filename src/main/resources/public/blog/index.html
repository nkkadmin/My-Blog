<html>
    <head>
        <title>HOME</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
        <link rel="stylesheet" href="../css/base.css">
        <style>
            .el-container:nth-child(5) .el-aside,
            .el-container:nth-child(6) .el-aside {
                line-height: 260px;
            }

            .el-container:nth-child(7) .el-aside {
                line-height: 320px;
            }
            .el-carousel__item h3 {
                color: #475669;
                font-size: 18px;
                opacity: 0.75;
                line-height: 300px;
                margin: 0;
                background-color: #475669;
            }

            .text {
                font-size: 14px;
            }
            .left_content .right_content{
                background-color: #fdfdfd;
                min-height: 500px;
            }

            .blog_item{
                border-bottom: 1px solid #f0f0f0;
                min-height: 131px;
                margin-bottom: 30px;
            }
            .blog_item_img{
                max-width: 100%;
                height: auto;
                border-radius: 5px;
            }
            .load_more{
                width: 400px;
                margin: 50px 0px 50px 300px;
            }
            .blog_content_list{
                margin-bottom: 100px;
            }
            .blog_item_title{
                height: 30px;
                font-size: 20px;
                font-weight: bold;
            }
            .blog_item_content{
                font-size: 13px;
                line-height: 24px;
                color: #999;
            }
            .blog_item_icon{
                font-size: 12px;
                color: #999;
            }
            .blog_item_icon img{
                margin-left: 15px;
                position: relative;
                top: 4px;
                right: 2px;
            }
        </style>
    </head>
    <body>
   <!-- <embed src="../muics/chai.mp3" hidden="true"/>-->
    <div id="app">
            <template>
                <header-content></header-content>
                <el-container>
                    <el-main>
                        <!--左侧列表-->
                        <el-row :gutter="20" class="blog_content_list">
                            <el-col :span="16" class="left_content">
                                <el-row  class="blog_item" :gutter="20" v-for="item in blogList" :key="item.id">
                                    <el-col :span="4">
                                        <div style="cursor: pointer;" @click="blogInfo(item.id)" class="grid-content bg-purple">
                                            <img class="blog_item_img" :src="item.coverPic"/>
                                        </div>
                                    </el-col>
                                    <el-col :span="20">
                                        <div style="cursor: pointer;" @click="blogInfo(item.id)" class="grid-content bg-purple">
                                            <div class="blog_item_title">{{item.title}}</div>
                                            <div class="blog_item_content">{{item.content}}</div>
                                            <div class="blog_item_icon">
                                                <img src="../img/index/look-icon-16.png"/><span>{{item.lookNum == null ? 0 : item.lookNum}}</span>
                                                <img src="../img/index/comment-16-icon.png"/><span>{{item.commentNum == null ? 0 : item.commentNum}}</span>
                                                <img src="../img/index/dianzan-16-icon.png"/><span>{{item.zanNum == null ? 0 : item.zanNum}}</span>
                                            </div>
                                        </div>
                                    </el-col>
                                </el-row>
                                <el-button v-if="showLoadMore" @click="loadMoreFun" v-loading.fullscreen.lock="fullscreenLoading" class="load_more" type="warning" round>加载更多</el-button>
                            </el-col>
                            <!--右侧内容-->
                            <el-col :span="8">
                                <el-row>
                                    <el-col :gutter="20" :span="18">
                                        <el-input v-model="searchKey" placeholder="请输入关键字"></el-input>
                                    </el-col>
                                    <el-col :gutter="20" :span="6">
                                        <el-button @click="search" >搜索</el-button>
                                    </el-col>
                                </el-row>
                            </el-col>
                        </el-row>
                    </el-main>
                </el-container>
                <footer-content></footer-content>
            </template>
        </div>
    </body>
    <script type="text/javascript" src="../js/vue.js"></script>
    <script type="text/javascript" src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script src="../js/index/component.js"></script>
<script>
    var Main = {
            methods: {
                search:function(){
                    this.blogTitle = this.searchKey;
                    this.getBlogByMenuId(this.currentMenuId);
                },
                loadData:function(){
                    var self = this;
                    self.tableData = [];
                    self.isAppend = false;
                    axios.post("/index/blog/index",null).then(function(response){
                        console.log(response);
                        if(response != null && response.data.menu != null){
                            self.menuList = response.data.menu;
                        }
                        if(self.menuList.length > 0){
                            //获取第一个菜单
                            var menuId = self.menuList[0].id;
                            self.currentMenuId = menuId;
                            self.getBlogByMenuId(menuId);
                        }
                    });
                },
                getBlogByMenuId:function(menuId){
                    var self = this;
                    if (!self.isAppend){
                        self.blogList.splice(0,self.blogList.length);
                    }
                    axios.post("/index/blog/getBlog",{"pageNo":self.page.pageNo,"pageSize":self.page.pageSize,"menuId":menuId,"blogTitle":self.blogTitle}).then(function(response){
                        console.log(response);
                        if(response.data != null && response.data.list != null){
                            for ( var i = 0; i <response.data.list.length; i++){
                                self.blogList.push(response.data.list[i]);
                            }
                            self.page.totalPage = response.data.pages;
                            self.page.totalSize = response.data.total;
                            if (self.page.pageNo >= self.page.totalPage){
                                self.showLoadMore = false;
                            }else{
                                $(".load_more").text("加载数据");
                                self.showLoadMore = true;
                            }
                        }
                        self.fullscreenLoading = false;
                    });
                },
                loadMoreFun() {
                    if(this.page.pageNo < this.page.totalPage){
                        this.fullscreenLoading = true;
                        this.isAppend = true;
                        this.page.pageNo += 1;
                        //获取当前选中的菜单
                        this.getBlogByMenuId(this.currentMenuId);
                    }else{
                        $(".load_more").text("没有多余的数据");
                    }
                },
                blogInfo(id){
                    window.location.href = "blog.html?id="+id;
                }
            },
            data() {
                return {
                    searchKey:"",
                    currentMenuId:'',
                    defaultIndex:'0',
                    blogTitle:"",
                    currentDate: new Date(),
                    menuList:[],
                    blogList:[],
                    searchKey:'', //搜索关键字
                    showLoadMore:false,
                    fullscreenLoading: false,
                    page:{
                        pageNo:1,
                        pageSize:10,
                        totalPage:1,//共几页
                        totalSize:0 //共几条记录
                    },
                    isAppend:false
                }
            },
            mounted:function(){
                this.loadData();
            }
        }
        var Ctor = Vue.extend(Main)
        new Ctor().$mount('#app')
    </script>
</html>