<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta charset="UTF-8">
    <!-- Include the Quill library -->
    <script src="https://cdn.quilljs.com/1.3.4/quill.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <!-- Quill JS Vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue-quill-editor@3.0.4/dist/vue-quill-editor.js"></script>


    <script type="text/javascript" src="../../js/vue.js"></script>
    <script type="text/javascript" src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script type="text/javascript" src="../../js/url.js"></script>
    <!-- Include stylesheet -->
    <link href="https://cdn.quilljs.com/1.3.4/quill.core.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.4/quill.snow.css" rel="stylesheet">
    <link href="https://cdn.quilljs.com/1.3.4/quill.bubble.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <style>
        .avatar-uploader .el-upload {
            border: 1px dashed #d9d9d9;
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        .avatar-uploader .el-upload:hover {
            border-color: #409EFF;
        }
        .avatar-uploader-icon {
            font-size: 28px;
            color: #8c939d;
            width: 178px;
            height: 178px;
            line-height: 178px;
            text-align: center;
        }
        .avatar {
            width: 178px;
            height: 178px;
            display: block;
        }
    </style>
</head>
<body>
<div id="vueapp">
    <template>
        <el-form ref="form" :model="form" label-width="80px">
            <el-input v-model="form.menuId" style="display: none;"></el-input>
            <el-form-item label="标题">
                <el-input v-model="form.title" style="width:400px;"></el-input>
            </el-form-item>
            <el-form-item label="封面">
                <el-upload
                        class="avatar-uploader"
                        action="/file/upload"
                        :show-file-list="false"
                        :auto-upload="true"
                        name="file"
                        :on-success="uploadSuccess"
                        :on-change="changeFile"
                        :before-upload="beforeAvatarUpload">
                    <img v-if="form.coverPic" :src="form.coverPic" class="avatar">
                    <i v-else class="el-icon-plus avatar-uploader-icon"></i>
                </el-upload>
                <el-dialog :visible.sync="dialogVisible">
                    <img width="100%" :src="dialogImageUrl" alt="">
                </el-dialog>
            </el-form-item>
            <el-form-item label="摄影目的地">
                <el-input v-model="form.distName" style="width:400px"></el-input>(多个目的地逗号分开)
            </el-form-item>
            <el-form-item label="分类">
                <el-select v-model="form.tagId" placeholder="">
                    <el-option v-for="(item) in tags" :label="item.name" :value="item.id"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="内容">
                <quill-editor v-model="form.content"
                              ref="quillEditorA"
                              :options="editorOption"
                              style="height:400px;">
                </quill-editor>
            </el-form-item>
        </el-form>
        <el-button type="primary" @click="save">保存</el-button>
    </template>
</div>
<script>
    Vue.use(VueQuillEditor)
    new Vue({
        el: '#vueapp',
        data: {
            form:{
                id:"",
                title:"",
                content:"",
                menuId:"",
                tagId:"",
                coverPic:"",
                distName:""
            },
            tags:[],
            base64:"",
            dialogImageUrl:"",
            dialogVisible: false,
            editorOption: {
                theme: 'snow'
            }
        },
        components: {
            LocalQuillEditor: VueQuillEditor.quillEditor
        },
        methods: {
            initData(){
                var self = this;
                axios.post("/adminBlog/initData").then(function(response){
                    console.log(response);
                    if(response.data.content.menus != null){
                        for(var i = 0;i<response.data.content.menus.length;i++){
                            var info = response.data.content.menus;
                            if(info[i].name === "摄影作品"){
                                self.form.menuId = info[i].id;
                                break;
                            }
                        }
                    }
                    if(response.data.content.tags != null){
                        for(var i = 0;i<response.data.content.tags.length;i++){
                            var info = response.data.content.tags;
                            var tag = new Object();
                            tag.name = info[i].name;
                            tag.id = info[i].id;
                            self.tags.push(tag);
                        }
                    }
                })
            },
            save(){//保存
                var self = this;
                console.log(this.form);
                axios.post("/adminBlog/edit",this.form).then(function(response){
                    console.log(response);
                    if(response.data){
                        self.$message({
                            showClose: true,
                            message: '保存成功',
                            type: 'success'
                        });
                    }
                })
            },
            findOne(){
                var self = this;
                axios.get("/adminBlog/selectById",{params:{"id":this.form.id}}).then(function(response){
                    if(response.data != null){
                        var info = response.data;
                        self.form.title = info.title;
                        self.form.content = info.content;
                        self.form.menuId = info.menu.id;
                        self.form.tagId = info.tags.id;
                    }
                });
            },
            changeFile:function(file, fileList){
                console.log(file);
            },
            uploadSuccess(response, file, fileList){
                this.form.coverPic = response.substring(0,response.length-1);
            },
            beforeAvatarUpload(file) {
                const isImg = 'image/jpeg;image/png'.indexOf(file.type);
                const isLt2M = file.size / 1024 / 1024 < 2;
                if (isImg < 0) {
                    this.$message.error('上传头像图片只能是 JPG 格式!');
                }
                if (!isLt2M) {
                    this.$message.error('上传头像图片大小不能超过 2MB!');
                }
                return isImg && isLt2M;
            }
        },
        mounted:function(){
            this.initData();
            var param = GetRequest();
            if(Object.keys(param).length > 0){
                this.form.id = param.id;
                this.findOne();
            }
        }
    })
</script>
</body>


</html>