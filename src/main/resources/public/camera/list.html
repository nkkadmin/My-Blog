<html>
    <head>
        <title>HOME</title>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
        <link rel="stylesheet" href="../css/base.css">
        <style>
            .el-carousel__item h3 {
                color: #475669;
                font-size: 14px;
                opacity: 0.75;
                line-height: 200px;
                margin: 0;
            }

            .el-carousel__item:nth-child(2n) {
                background-color: #99a9bf;
            }

            .el-carousel__item:nth-child(2n+1) {
                background-color: #d3dce6;
            }
        </style>
    </head>
    <body>
   <!-- <embed src="../muics/chai.mp3" hidden="true"/>-->
    <div id="app">
            <template>
                <header-content></header-content>
                <el-container>

                    <el-main>
                        <template>
                            <el-carousel :interval="4000" type="card" height="300px">
                                <el-carousel-item v-for="item in 6" :key="item">
                                    <h3>{{ item }}</h3>
                                </el-carousel-item>
                            </el-carousel>
                        </template>

                    </el-main>
                </el-container>
                <footer-content></footer-content>
            </template>
        </div>
    </body>
    <script type="text/javascript" src="../js/vue.js"></script>
    <script type="text/javascript" src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script type="text/javascript" src="../js/jquery.min.js"></script>
    <script src="../js/index/component.js"></script>
<script>
    var Main = {
            methods: {
                loadData(){
                    var self = this;
                    self.tableData = [];
                    self.isAppend = false;
                    axios.post("/index/blog/index",null).then(function(response){
                        console.log(response);
                        if(response.data != null && response.data.menu != null){
                            self.menuList = response.data.menu;
                        }
                        if(self.menuList.length > 0){
                            //获取第一个菜单
                            var menuId = self.menuList[0].id;
                            self.currentMenuId = menuId;
                            self.getBlogByMenuId(2);
                        }
                    });
                },
                getBlogByMenuId:function(menuId){
                    var self = this;
                    if (!self.isAppend){
                        self.blogList.splice(0,self.blogList.length);
                    }
                    axios.post("/index/blog/getBlog",{"pageNo":self.page.pageNo,"pageSize":self.page.pageSize,"menuId":menuId}).then(function(response){
                        console.log(response);
                        if(response.data != null && response.data != null){
                            for ( var i = 0; i <response.data.list.length; i++){
                                self.blogList.push(response.data.list[i]);
                            }
                            self.page.totalPage = response.data.pages;
                            self.page.totalSize = response.data.totalElements;
                            if (self.page.pageNo >= self.page.totalPage){
                                $(".load_more").hide();
                            }else{
                                $(".load_more").text("加载数据");
                                $(".load_more").show();
                            }
                        }
                        self.fullscreenLoading = false;
                    });
                },
                handleSelect(key, keyPath) {
                    var menuId = $(".menuItem"+key).attr("menu-id");
                    this.currentMenuId = menuId;
                    this.isAppend = false;
                    this.getBlogByMenuId(menuId);
                },
                loadMoreFun() {
                    if(this.page.pageNo < this.page.totalPage){
                        this.fullscreenLoading = true;
                        this.isAppend = true;
                        this.page.pageNo += 1;
                        //获取当前选中的菜单
                        this.getBlogByMenuId(this.currentMenuId);
                    }else{
                        $(".load_more").text("没有多余的数据");
                    }
                },
                blogInfo(id){
                    window.location.href = "blog.html?id="+id;
                }
            },
            data() {
                return {
                    currentMenuId:'',
                    defaultIndex:'0',
                    currentDate: new Date(),
                    menuList:[],
                    blogList:[],
                    searchKey:'', //搜索关键字
                    fullscreenLoading: false,
                    page:{
                        pageNo:1,
                        pageSize:10,
                        totalPage:1,//共几页
                        totalSize:0 //共几条记录
                    },
                    isAppend:false
                }
            },
            mounted:function(){
                this.loadData();
            }
        }
        var Ctor = Vue.extend(Main)
        new Ctor().$mount('#app')
    </script>
</html>